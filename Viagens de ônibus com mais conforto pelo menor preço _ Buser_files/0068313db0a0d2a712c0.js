(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1092:function(e,t,n){},1134:function(e,t,n){},1138:function(e,t,n){},1151:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var r=n(353);t.default=r.default},1869:function(e,t,n){"use strict";n(1092)},1920:function(e,t,n){e.exports=n.p+"img/selo-carbonext-home.d8db2cd.png"},1921:function(e,t,n){e.exports=n.p+"img/logo-carbonext.085adce.png"},1922:function(e,t,n){"use strict";n(1134)},1926:function(e,t,n){e.exports=n.p+"img/buser_encomendas_logo.791847a.png"},1927:function(e,t,n){e.exports=n.p+"img/buser_encomendas_caixas.d9ff825.png"},1928:function(e,t,n){"use strict";n(1138)},1943:function(e,t,n){"use strict";n(1151)},1971:function(e,t,n){"use strict";n.r(t);var r={name:"banner-carbon-friendly",serverCacheKey:function(){return"static"}},o=(n(1922),n(4)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"banner-carbon-friendly"},[r("div",{staticClass:"bcf-selo"},[r("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],staticClass:"bcfs-selo",attrs:{"data-src":n(1920),alt:"Selo Carbono Neutro",width:"140",height:"140"}}),e._v(" "),r("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],staticClass:"bcfs-logo",attrs:{"data-src":n(1921),alt:"Carbonext - Nature & Future",width:"130",height:"27"}})]),e._v(" "),r("p",{staticClass:"bcf-text"},[e._v("\n    Agora todas as viagens com a Buser são mais sustentáveis e amigas\n    do meio ambiente!\n  ")]),e._v(" "),r("ada-link",{staticClass:"bcf-link",attrs:{appearance:"button",rounded:"",color:"primary",to:{name:"sustentabilidade"}}},[e._v("\n    Saiba mais\n  ")])],1)}),[],!1,null,"bf331c20",null);t.default=component.exports},1975:function(e,t,n){"use strict";n.r(t);var r=n(0),o={name:"banner-encomendas",methods:{saibaMais:function(){r.a.$emit("clicou-buser-encomendas")}}},c=(n(1928),n(4)),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"banner-encomendas"},[r("ada-container",{staticClass:"be-container"},[r("div",[r("h1",{staticClass:"title bec-title"},[e._v("Agora você pode enviar suas encomendas com a Buser!")]),e._v(" "),r("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],staticClass:"bec-logo",attrs:{alt:"logo do Buser encomendas",src:n(1926)}})]),e._v(" "),r("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],staticClass:"bec-caixas",attrs:{alt:"caixas do Buser encomendas",src:n(1927)}}),e._v(" "),r("ada-link",{staticClass:"tt-uppercase",attrs:{"aria-label":"saiba mais",target:"_blank",href:"/encomendas",appearance:"button",color:"white",rel:"nofollow noopener external",rounded:""},nativeOn:{click:function(t){return e.saibaMais.apply(null,arguments)}}},[e._v("\n      Saiba mais\n    ")])],1)],1)}),[],!1,null,"6f39043e",null);t.default=component.exports},1979:function(e,t,n){"use strict";n.r(t);var r=n(2),o=(n(17),n(3)),c=n(25),l=n(1076),m=n(1165),d=n(1166),f={components:{popupPromoRegras:m.a,popupUsarCupom:d.a},data:function(){return{promo:null,cupons:[],loading:!1,popupPromoRegrasVisible:!1,popupUserCupomVisible:!1,mensagemDesconto:null,mensagemRestricao:null}},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.setupInfoCupom();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:e.mensagemDesconto=n.mensagemDesconto,e.mensagemRestricao=n.mensagemRestricao,e.promo=n.promo,e.$emit("loaded");case 9:case"end":return t.stop()}}),t)})))()},methods:{getCupomLead:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,o.a.passenger.getCupomLead();case 4:n=t.sent,r=n.cupons,e.cupons=r,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.$store.commit("toast/open",{message:"Ocorreu um erro ao carregar os cupons",type:"error"});case 12:return t.prev=12,e.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,9,12,15]])})))()},alterarCupom:function(){this.getCupomLead(),this.popupUserCupomVisible=!0},removerCupom:function(){c.a.setItem("promo",""),window.location.reload()}}},v=(n(1943),n(4)),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.mensagemDesconto?n("ada-alert",{staticClass:"alerta-cupom-ativado",attrs:{type:"success",icon:["fal","ticket-simple"]}},[n("div",{staticClass:"aca-container"},[n("div",{staticClass:"fg-1"},[n("p",{staticClass:"title-1"},[e._v("\n        "+e._s(e.mensagemDesconto)+"\n      ")]),e._v(" "),e.mensagemRestricao?n("p",{staticClass:"subtitle my-1"},[e._v("\n        "+e._s(e.mensagemRestricao)+"\n      ")]):e._e()]),e._v(" "),n("ada-button",{staticClass:"acac-ver-mais",attrs:{"aria-label":"Ver regras e outros cupons",color:"green",transparent:""},on:{click:function(t){e.popupPromoRegrasVisible=!0}}},[e._v("\n      Ver regras e outros cupons\n      "),n("fa",{staticClass:"ml-1",attrs:{icon:["fas","chevron-right"],size:"lg"}})],1)],1),e._v(" "),n("popup-promo-regras",{attrs:{promo:e.promo,visible:e.popupPromoRegrasVisible},on:{close:function(t){e.popupPromoRegrasVisible=!1}}},[n("div",{staticClass:"aca-actions"},[n("ada-button",{staticClass:"text-2",attrs:{transparent:""},on:{click:e.alterarCupom}},[e._v("\n        Alterar cupom\n      ")]),e._v(" "),n("fa",{staticClass:"mx-1 text-primary text-1",attrs:{icon:["fas","circle"]}}),e._v(" "),n("ada-button",{staticClass:"text-2",attrs:{transparent:""},on:{click:e.removerCupom}},[e._v("\n        Remover cupom\n      ")])],1)]),e._v(" "),n("popup-usar-cupom",{attrs:{visible:e.popupUserCupomVisible,cupons:e.cupons,loading:e.loading},on:{close:function(t){e.popupUserCupomVisible=!1}}})],1):e._e()}),[],!1,null,"934ede38",null);t.default=component.exports},353:function(e,t,n){"use strict";n.r(t);n(12),n(13),n(16),n(20),n(21);var r=n(7),o=n(2),c=(n(17),n(10),n(3)),l=n(28),m=n(29),d=n(38);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var v={middleware:"logged-user",layout:"andromeda",props:{field:{type:String,required:!0}},data:function(){return{rules:d.a,breadcrumbs:[],userData:{name:"",email:"",oldEmail:"",newEmail:"",phone:"",oldPhone:""},sent:!1,pendingEmailConfirmation:null,resendCountdown:null}},created:function(){this.userData.name=this.currentUser.name,this.userData.email=this.currentUser.email,this.userData.oldEmail=this.currentUser.email,this.userData.phone=this.currentUser.cell_phone,this.userData.oldPhone=this.currentUser.cell_phone},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.field||e.redirectToProfile(),e.breadcrumbs=[{route:{name:"home"},text:"Home"},{route:{name:"profile"},text:"Editar perfil"},{route:{name:"editProfile"},text:"Atualizar ".concat(e.field)}],"email"!==e.field){t.next=5;break}return t.next=5,e.verifyEmailChange();case 5:case"end":return t.stop()}}),t)})))()},computed:{currentUser:function(){return this.$store.state.auth.currentUser},updatedField:function(){return{nome:"name",email:"email",celular:"phone"}[this.field]},emailButton:function(){return null===this.resendCountdown?"Aguarde":this.resendEmailButtonDisabled?"Aguarde ".concat(this.resendCountdown," segundos"):"Reenviar email"},buttonText:function(){return this.sent?"Fechar":"Salvar"},resendEmailButtonDisabled:function(){return this.resendCountdown>0||null===this.resendCountdown},showEmail:function(){return"email"===this.field&&null!==this.pendingEmailConfirmation},showCelular:function(){return"celular"===this.field},showName:function(){return"nome"===this.field}},methods:{update:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var data,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.field){t.next=2;break}return t.abrupt("return");case 2:return data=Object(r.a)({},e.updatedField,e.userData[e.updatedField]),t.prev=3,t.next=6,c.a.auth.saveUser(data);case 6:null!=(n=t.sent)&&n.user&&(e.sent=!0,e.$store.commit("auth/setCurrentUser",n.user),e.showName&&e.redirectToProfile()),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),e.openToast(t.t0);case 13:case"end":return t.stop()}}),t,null,[[3,10]])})))()},resendEmail:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.a.auth.resendEmailChange();case 3:e.verifyEmailChange(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),e.openToast(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()},verifyEmailChange:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.a.auth.verifyEmailChange();case 3:null!=(n=t.sent)&&n.new_email?(e.resendCountdown=n.resend_timeout,e.userData.newEmail=n.new_email,e.sent=!0,e.pendingEmailConfirmation=!0):e.pendingEmailConfirmation=!1,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.openToast(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},cancelEmailChange:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.a.auth.cancelEmailChange();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),e.openToast(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()},changeEmailVerification:function(){this.cancelEmailChange(),this.sent=!1,this.verifyEmailChange()},cancelAndRedirect:function(){this.cancelEmailChange(),this.redirectToProfile()},openToast:function(e){this.$store.commit("toast/open",{message:"Ops! ".concat(e.message),type:"error"})},redirectToProfile:function(){m.a.push("profile",this.$route.name,null,null,this.$router)}},watch:{resendCountdown:{handler:function(e){var t=this;e>0&&setTimeout((function(){t.resendCountdown--}),1e3)},immediate:!0}},head:function(){return function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},l.a.generateMetaTags({title:"Atualizar ".concat(this.field),robots:"noindex, nofollow"}))}},x=v,h=(n(1869),n(4)),component=Object(h.a)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"edit-profile"},[n("ada-header",{attrs:{title:"Atualizar "+e.field},scopedSlots:e._u([{key:"breadcrumbs",fn:function(){return[n("ada-breadcrumbs",{attrs:{items:e.breadcrumbs}})]},proxy:!0}])}),e._v(" "),n("ada-container",{staticClass:"ep-container"},[e.showName?[n("ada-input",{staticClass:"mb-5",attrs:{rules:[e.rules.required],label:"Nome completo"},model:{value:e.userData.name,callback:function(t){e.$set(e.userData,"name",t)},expression:"userData.name"}}),e._v(" "),n("ada-button",{on:{click:e.update}},[e._v("Salvar")])]:e.showCelular?[e.sent?n("p",{staticClass:"epc-text",attrs:{"data-testid":"cellphone-message"}},[e._v("\n        Enviamos no número\n        "),n("strong",[e._v(e._s(e._f("phone")(e.userData.oldPhone)))]),e._v(" um SMS para\n        confirmar a atualização. Acesse o link enviado para finalizar.\n      ")]):[n("p",{staticClass:"epc-text"},[e._v("\n          Enviaremos um SMS para confirmar a atualização do seu número.\n        ")]),e._v(" "),n("ada-input",{staticClass:"mb-5",attrs:{rules:[e.rules.required,e.rules.minlen(10)],mask:"(00) 00000-0000",label:"Celular"},model:{value:e.userData.phone,callback:function(t){e.$set(e.userData,"phone",t)},expression:"userData.phone"}})],e._v(" "),n("ada-button",{on:{click:function(t){e.sent?e.redirectToProfile():e.update()}}},[e._v("\n        "+e._s(e.buttonText)+"\n      ")])]:e.showEmail?[e.pendingEmailConfirmation?[n("p",{staticClass:"epc-text",attrs:{"data-testid":"email-pending-message"}},[e._v("\n          Seu email foi alterado para "),n("strong",[e._v(e._s(e.userData.newEmail))])]),e._v(" "),n("ada-button",{staticClass:"epc-inline-button",attrs:{transparent:"",small:""},on:{click:e.changeEmailVerification}},[e._v("\n          Não é seu email? Clique aqui para alterar\n        ")]),e._v(" "),n("p",{staticClass:"epc-text",attrs:{"data-testid":"email-confirm-message"}},[e._v("\n          Enviamos um email para confirmar o seu cadastro. Acesse seu email\n          "),n("strong",[e._v(e._s(e.userData.oldEmail))]),e._v(" para finalizar.\n        ")]),e._v(" "),n("ada-button",{staticClass:"epc-inline-button",attrs:{transparent:"",small:""},on:{click:e.cancelAndRedirect}},[e._v("\n          Não foi você que fez essa solicitação? Clique aqui para cancelar\n        ")]),e._v(" "),n("p",{staticClass:"epc-text"},[e._v("\n          Caso ainda não tenha recebido o email aperte o botão que\n          reenviaremos.\n        ")]),e._v(" "),n("ada-button",{attrs:{disabled:e.resendEmailButtonDisabled},on:{click:e.resendEmail}},[e._v("\n          "+e._s(e.emailButton)+"\n        ")])]:[e.sent?n("p",{staticClass:"epc-text",attrs:{"data-testid":"email-sent-message"}},[e._v("\n          Enviamos um email para confirmar a atualização. Acesse seu email\n          "),n("strong",[e._v(e._s(e.userData.oldEmail))]),e._v(" para finalizar.\n        ")]):[n("p",{staticClass:"epc-text",attrs:{"data-testid":"email-send-message"}},[e._v("\n            Enviaremos no seu email cadastrado atualmente um email para\n            confirmar a atualização, certifique-se de ter\n            "),n("span",{staticClass:"epct-red"},[e._v("acesso ao email já cadastrado")]),e._v(".\n          ")]),e._v(" "),n("ada-input",{staticClass:"mb-5",attrs:{rules:[e.rules.required,e.rules.email],inputmode:"email",label:"Email"},model:{value:e.userData.email,callback:function(t){e.$set(e.userData,"email",t)},expression:"userData.email"}})],e._v(" "),n("ada-button",{on:{click:function(t){e.sent?e.redirectToProfile():e.update()}}},[e._v("\n          "+e._s(e.buttonText)+"\n        ")])]]:e._e()],2)],1)}),[],!1,null,"878de66a",null);t.default=component.exports},363:function(e,t,n){"use strict";n.r(t);n(12),n(13),n(16),n(20),n(21);var r=n(7),o=n(2),c=(n(17),n(27)),l=n(689),m=n.n(l),d=n(19),f=n(3),v=n(29),x=n(109),h=n(152);function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function w(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}jest.mock("~api",(function(){return{auth:{saveUser:jest.fn(),resendEmailChange:jest.fn(),verifyEmailChange:jest.fn(),cancelEmailChange:jest.fn()}}})),jest.mock("~/helpers/routehelper",(function(){return{push:jest.fn()}}));var B={open:jest.fn()},C={currentUser:{name:"Vasco",email:"vasco@buser.com.br",cell_phone:"(84) 99999-9999"}},O={setCurrentUser:jest.fn()},j=new d.default.Store({modules:{toast:{mutations:B,namespaced:!0},auth:{state:C,mutations:O,namespaced:!0}}}),R=function(e){return Object(c.render)(h.default,{routes:Object(x.a)(),props:e,store:j})};describe("Editar perfil",(function(){beforeEach((function(){jest.clearAllMocks()})),it("should return to previous page",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({field:""}),e.next=3,Object(c.waitFor)((function(){return expect(v.a.push).toHaveBeenCalledWith("profile","home",null,null,expect.anything())}));case 3:case"end":return e.stop()}}),e)})))),it("should render breadcrumbs",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({field:"nome"}),e.next=3,Object(c.waitFor)((function(){return expect(c.screen.getByText("Home")).toBeVisible()}));case 3:return e.next=5,Object(c.waitFor)((function(){return expect(c.screen.getByText("Editar perfil")).toBeVisible()}));case 5:return e.next=7,Object(c.waitFor)((function(){return expect(c.screen.getAllByText("Atualizar nome")).toHaveLength(2)}));case 7:case"end":return e.stop()}}),e)})))),it("should render with label name",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({field:"nome"}),e.next=3,Object(c.waitFor)((function(){return expect(c.screen.getByText("Atualizar nome")).toBeVisible()}));case 3:return e.next=5,Object(c.waitFor)((function(){return expect(c.screen.getByLabelText("Nome completo")).toBeVisible()}));case 5:return e.next=7,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 7:case"end":return e.stop()}}),e)})))),it("should call saveUser passing a new name",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.saveUser.mockResolvedValue({user:{name:"Dudinha",cell_phone:"(84) 99999-9999",email:"vasco@buser.com.br"}}),R({field:"nome"}),e.next=4,m.a.type(c.screen.getByLabelText("Nome completo"),"Dudinha");case 4:return e.next=6,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 6:return e.next=8,Object(c.waitFor)((function(){return expect(f.a.auth.saveUser).toHaveBeenCalled()}));case 8:return e.next=10,Object(c.waitFor)((function(){return expect(O.setCurrentUser).toHaveBeenCalledWith(expect.anything(),w(w({},C.currentUser),{},{name:"Dudinha"}))}));case 10:return e.next=12,Object(c.waitFor)((function(){return expect(v.a.push).toHaveBeenCalledWith("profile","home",null,null,expect.anything())}));case 12:case"end":return e.stop()}}),e)})))),it("should emit error toast",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.saveUser.mockRejectedValue({message:"Deu ruim"}),R({field:"nome"}),e.next=4,m.a.type(c.screen.getByLabelText("Nome completo"),"dudinha");case 4:return e.next=6,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 6:return e.next=8,Object(c.waitFor)((function(){return expect(f.a.auth.saveUser).toHaveBeenCalled()}));case 8:return e.next=10,Object(c.waitFor)((function(){return expect(B.open).toHaveBeenCalledWith(expect.anything(),{message:"Ops! Deu ruim",type:"error"})}));case 10:return e.next=12,Object(c.waitFor)((function(){return expect(v.a.push).not.toHaveBeenCalled()}));case 12:case"end":return e.stop()}}),e)})))),it("should render with label celular",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({field:"celular"}),e.next=3,Object(c.waitFor)((function(){return expect(c.screen.getByText("Atualizar celular")).toBeVisible()}));case 3:return e.next=5,Object(c.waitFor)((function(){return expect(c.screen.getByText("Enviaremos um SMS para confirmar a atualização do seu número.")).toBeVisible()}));case 5:return e.next=7,Object(c.waitFor)((function(){return expect(c.screen.getByLabelText("Celular")).toBeVisible()}));case 7:return e.next=9,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 9:case"end":return e.stop()}}),e)})))),it("should call saveUser passing a new cell_phone",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.saveUser.mockResolvedValue({user:{name:"Vasco",cell_phone:"(84) 12345-6789",email:"vasco@buser.com.br"}}),R({field:"celular"}),e.next=4,m.a.type(c.screen.getByLabelText("Celular"),"(84) 12345-6789");case 4:return e.next=6,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 6:return e.next=8,Object(c.waitFor)((function(){return expect(f.a.auth.saveUser).toHaveBeenCalled()}));case 8:return e.next=10,Object(c.waitFor)((function(){return expect(O.setCurrentUser).toHaveBeenCalledWith(expect.anything(),w(w({},C.currentUser),{},{cell_phone:"(84) 12345-6789"}))}));case 10:return e.next=12,Object(c.waitFor)((function(){return expect(c.screen.getByTestId("cellphone-message")).toBeVisible()}));case 12:return e.next=14,m.a.click(c.screen.getByRole("button",{name:"Fechar"}));case 14:return e.next=16,Object(c.waitFor)((function(){return expect(v.a.push).toHaveBeenCalledWith("profile","home",null,null,expect.anything())}));case 16:case"end":return e.stop()}}),e)})))),it("should render with label email",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R({field:"email"}),e.next=3,Object(c.waitFor)((function(){return expect(c.screen.getByText("Atualizar email")).toBeVisible()}));case 3:return e.next=5,Object(c.waitFor)((function(){return expect(c.screen.getByTestId("email-send-message")).toBeVisible()}));case 5:return e.next=7,Object(c.waitFor)((function(){return expect(c.screen.getByLabelText("Email")).toBeVisible()}));case 7:return e.next=9,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 9:case"end":return e.stop()}}),e)})))),it("should call saveUser passing a new email",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.saveUser.mockResolvedValue({user:{name:"Vasco",cell_phone:"(84) 99999-9999",email:"dudinha@buser.com.br"}}),R({field:"email"}),e.next=4,Object(c.waitFor)((function(){return expect(c.screen.getByLabelText("Email")).toBeVisible()}));case 4:return e.next=6,m.a.type(c.screen.getByLabelText("Email"),"dudinha@buser.com.br");case 6:return e.next=8,m.a.click(c.screen.getByRole("button",{name:"Salvar"}));case 8:return e.next=10,Object(c.waitFor)((function(){return expect(f.a.auth.saveUser).toHaveBeenCalled()}));case 10:return e.next=12,Object(c.waitFor)((function(){return expect(O.setCurrentUser).toHaveBeenCalledWith(expect.anything(),w(w({},C.currentUser),{},{email:"dudinha@buser.com.br"}))}));case 12:return e.next=14,Object(c.waitFor)((function(){return expect(c.screen.getByTestId("email-sent-message")).toBeVisible()}));case 14:return e.next=16,m.a.click(c.screen.getByRole("button",{name:"Fechar"}));case 16:return e.next=18,Object(c.waitFor)((function(){return expect(v.a.push).toHaveBeenCalledWith("profile","home",null,null,expect.anything())}));case 18:case"end":return e.stop()}}),e)})))),it("should show pendingEmailConfirmation with label email",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.verifyEmailChange.mockResolvedValue({new_email:"vascodagama@buser.com.br"}),R({field:"email"}),e.next=4,Object(c.waitFor)((function(){return expect(c.screen.getByTestId("email-pending-message")).toBeVisible()}));case 4:return e.next=6,Object(c.waitFor)((function(){return expect(c.screen.getByRole("button",{name:"Não é seu email? Clique aqui para alterar"})).toBeVisible()}));case 6:return e.next=8,Object(c.waitFor)((function(){return expect(c.screen.getByTestId("email-confirm-message")).toBeVisible()}));case 8:return e.next=10,Object(c.waitFor)((function(){return expect(c.screen.getByRole("button",{name:"Não foi você que fez essa solicitação? Clique aqui para cancelar"})).toBeVisible()}));case 10:return e.next=12,Object(c.waitFor)((function(){return expect(c.screen.getByText("Caso ainda não tenha recebido o email aperte o botão que reenviaremos.")).toBeVisible()}));case 12:case"end":return e.stop()}}),e)})))),it("should cancel and redirect",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.a.auth.verifyEmailChange.mockResolvedValue({new_email:"vascodagama@buser.com.br"}),f.a.auth.cancelEmailChange.mockResolvedValue(),R({field:"email"}),e.next=5,Object(c.waitFor)((function(){return expect(c.screen.getByRole("button",{name:"Não foi você que fez essa solicitação? Clique aqui para cancelar"})).toBeVisible()}));case 5:return e.next=7,m.a.click(c.screen.getByRole("button",{name:"Não foi você que fez essa solicitação? Clique aqui para cancelar"}));case 7:return e.next=9,Object(c.waitFor)((function(){return expect(v.a.push).toHaveBeenCalledWith("profile","home",null,null,expect.anything())}));case 9:case"end":return e.stop()}}),e)}))))}))},366:function(e,t,n){"use strict";n.r(t);var r=n(7),o=n(2),c=(n(17),n(14),n(12),n(13),n(16),n(20),n(21),n(27)),l=n(689),m=n.n(l),d=n(19),f=n(109),v=n(347),x=n(3);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}jest.mock("~api",(function(){return{everyone:{getStatusVerificarCadastro:jest.fn(),validarVerificacaoCadastro:jest.fn(),verificarCadastro:jest.fn()}}}));var w,B={name:"Luiz Carvalho",birth:"22071993",rg:"458621626",cpf:"41993897844",passaporte:"123456789"},C="22/07/1993",O="419.938.978-44",j={whoami:jest.fn()},R={updateCurrentUser:jest.fn()};function _(e){return w=new d.default.Store({modules:{settings:{getters:{isApp:function(){return e}},namespaced:!0},auth:{actions:j,mutations:R,namespaced:!0}}}),Object(c.render)(v.default,{routes:Object(f.a)(),store:w,stubs:["fa"]})}describe("Verificar cadastro on app",(function(){afterEach((function(){jest.clearAllMocks()})),it("should confirm registration",Object(o.a)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.resolve({verification_status:"unverified"})})),x.a.everyone.validarVerificacaoCadastro.mockImplementation((function(){return Promise.resolve({})})),_(!0),expect(c.screen.getByText("Carregando dados do usuário...")).toBeVisible(),expect(x.a.everyone.getStatusVerificarCadastro).toHaveBeenCalledTimes(1),e.t0=expect,e.next=8,c.screen.findByText("Verifique sua conta");case 8:return e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible(),m.a.type(c.screen.getByLabelText("Nome completo"),B.name),e.t2=expect,e.next=14,c.screen.findByDisplayValue(B.name);case 14:return e.t3=e.sent,(0,e.t2)(e.t3).toBeVisible(),m.a.type(c.screen.getByLabelText("Data de nascimento"),B.birth),e.t4=expect,e.next=20,c.screen.findByDisplayValue(C);case 20:return e.t5=e.sent,(0,e.t4)(e.t5).toBeVisible(),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t6=expect,e.next=26,c.screen.findByText("Seus documentos");case 26:return e.t7=e.sent,(0,e.t6)(e.t7).toBeVisible(),m.a.type(c.screen.getByLabelText("CPF"),B.cpf),e.t8=expect,e.next=32,c.screen.findByDisplayValue(O);case 32:return e.t9=e.sent,(0,e.t8)(e.t9).toBeVisible(),m.a.type(c.screen.getByLabelText("RG, CNH, RNE ou outro documento oficial com foto"),B.rg),e.t10=expect,e.next=38,c.screen.findByDisplayValue(B.rg);case 38:return e.t11=e.sent,(0,e.t10)(e.t11).toBeVisible(),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.next=43,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByRole("button",{name:"Continuar"})}));case 43:return expect(x.a.everyone.validarVerificacaoCadastro).toBeCalledWith({name:B.name,birth:B.birth,cpf:B.cpf,rg:B.rg}),e.t12=expect,e.next=47,c.screen.findByText("Instruções para foto");case 47:return e.t13=e.sent,(0,e.t12)(e.t13).toBeVisible(),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t14=expect,e.next=53,c.screen.findByText("Enviar fotos");case 53:return e.t15=e.sent,(0,e.t14)(e.t15).toBeVisible(),e.t16=expect,e.next=58,c.screen.findByText("Infelizmente seu dispositivo não suporta a captura de fotos direto no aplicativo.");case 58:return e.t17=e.sent,(0,e.t16)(e.t17).toBeVisible(),t=new File(["picture"],"picture.png",{type:"image/png"}),m.a.upload(c.screen.getByTestId("selfie-input-file"),t),m.a.upload(c.screen.getByTestId("frente-input-file"),t),m.a.upload(c.screen.getByTestId("verso-input-file"),t),e.t18=expect,e.next=67,c.screen.findByTestId("selfie-image");case 67:return e.t19=e.sent,(0,e.t18)(e.t19),e.t20=expect,e.next=72,c.screen.findByTestId("frente-image");case 72:return e.t21=e.sent,(0,e.t20)(e.t21),e.t22=expect,e.next=77,c.screen.findByTestId("verso-image");case 77:return e.t23=e.sent,(0,e.t22)(e.t23),r=new Promise((function(e,t){n=e})),x.a.everyone.verificarCadastro.mockReturnValue(r),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t24=expect,e.next=85,c.screen.findByText("Salvando dados");case 85:return e.t25=e.sent,(0,e.t24)(e.t25).toBeVisible(),n({}),expect(x.a.everyone.verificarCadastro).toBeCalledWith({name:B.name,birth:B.birth,rg:B.rg,cpf:B.cpf,passaporte:void 0,pics:{selfie:expect.anything(),frente:expect.anything(),verso:expect.anything()}},expect.anything()),e.next=91,Object(c.waitFor)((function(){return expect(j.whoami).toBeCalledTimes(1)}));case 91:return expect(R.updateCurrentUser).toBeCalledWith(expect.anything(),{verification_status:"pending"}),e.t26=expect,e.next=95,c.screen.findByText("Verificação de cadastro solicitada");case 95:e.t27=e.sent,(0,e.t26)(e.t27).toBeVisible(),expect(c.screen.getByRole("link",{name:"Ir para minha carteira"})).toBeVisible();case 98:case"end":return e.stop()}}),e)})))),it("should preload user informations",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.resolve(y({verification_status:"unverified"},B))})),_(),e.next=4,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByText("Carregando dados do usuário...")}));case 4:return e.t0=expect,e.next=7,c.screen.findByDisplayValue(B.name);case 7:return e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible(),e.t2=expect,e.next=12,c.screen.findByDisplayValue(C);case 12:return e.t3=e.sent,(0,e.t2)(e.t3).toBeVisible(),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t4=expect,e.next=18,c.screen.findByDisplayValue(O);case 18:return e.t5=e.sent,(0,e.t4)(e.t5).toBeVisible(),e.t6=expect,e.next=23,c.screen.findByDisplayValue(B.rg);case 23:e.t7=e.sent,(0,e.t6)(e.t7).toBeVisible();case 25:case"end":return e.stop()}}),e)})))),it("should skip to done when pending",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.resolve({verification_status:"pending"})})),_(),e.next=4,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByText("Carregando dados do usuário...")}));case 4:return e.t0=expect,e.next=7,c.screen.findByText("Verificação de cadastro solicitada");case 7:e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible();case 9:case"end":return e.stop()}}),e)})))),it("should already verified message",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.resolve({verification_status:"verified"})})),_(),e.next=4,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByText("Carregando dados do usuário...")}));case 4:return e.t0=expect,e.next=7,c.screen.findByText("Seu cadastro já está verificado");case 7:e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible();case 9:case"end":return e.stop()}}),e)})))),it("should show error message when get status fail and retry",Object(o.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.reject(new Error("error message"))})),_(),e.next=4,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByText("Carregando dados do usuário...")}));case 4:return expect(x.a.everyone.getStatusVerificarCadastro).toBeCalledTimes(1),e.t0=expect,e.next=8,c.screen.findByText("error message");case 8:e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible(),expect(c.screen.getByRole("link",{name:"Ir para página inicial"})).toBeVisible(),t=c.screen.getByRole("button",{name:"Tentar novamente"}),expect(t).toBeVisible(),m.a.click(t),expect(x.a.everyone.getStatusVerificarCadastro).toBeCalledTimes(2);case 15:case"end":return e.stop()}}),e)})))),it("should show error message if cpf validation fail",Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.a.everyone.getStatusVerificarCadastro.mockImplementation((function(){return Promise.resolve(y({verification_status:"unverified"},B))})),x.a.everyone.validarVerificacaoCadastro.mockImplementation((function(){return Promise.resolve({cpf_error:"error message"})})),_(),e.next=5,Object(c.waitForElementToBeRemoved)((function(){return c.screen.queryByText("Carregando dados do usuário...")}));case 5:return m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t0=expect,e.next=9,c.screen.findByText("Seus documentos");case 9:return e.t1=e.sent,(0,e.t0)(e.t1).toBeVisible(),m.a.click(c.screen.getByRole("button",{name:"Continuar"})),e.t2=expect,e.next=15,c.screen.findByText("error message");case 15:e.t3=e.sent,(0,e.t2)(e.t3).toBeVisible();case 17:case"end":return e.stop()}}),e)}))))}))}}]);